##############################################
# MVP用 docker-compose（最小構成）
# - backend のみを起動
# - フロントは Firebase Hosting を前提とし、コンテナは使用しない
# - 監視/DB/Redis/Nginx 等の非MVPサービスは含めない
##############################################

services:
  backend:
    build:
      context: .
      dockerfile: ./backend/Dockerfile
    container_name: gamechat-ai-backend-dev
    ports:
      - "8000:8000"
    environment:
      - ENVIRONMENT=development
      - CORS_ORIGINS=http://localhost:3000
    volumes:
      - ./backend/app:/app/app:ro
      - ./backend/requirements.txt:/app/requirements.txt:ro
      - ./backend/.env.ci:/app/backend/.env.production:ro
      - ./data:/data:ro
    env_file:
      - backend/.env
    networks:
      - gamechat-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Note:
# - Frontend container is intentionally omitted in MVP. Use Firebase Hosting deploy instead.
# - If you need logs/monitoring tools locally, add them temporarily in your local branch only.

networks:
  gamechat-network:
    driver: bridge

volumes: {}
