# ä¸å…·åˆèª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ: chat-history æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ã‹ãªã„ä»¶ï¼ˆ2025-08-15ï¼‰

æœ¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ feature/chat-history-management-113 ãƒ–ãƒ©ãƒ³ãƒã®ç¾çŠ¶ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€chat-history ãŒå‹•ä½œã—ãªã„åŸå› ã‚’æ•´ç†ã—ãŸã‚‚ã®ã§ã™ã€‚

## ç¾è±¡
- ã‚µã‚¤ãƒ‰ãƒãƒ¼å±¥æ­´ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼ˆå¸¸ã«ã€ŒNo chat sessions foundã€ï¼‰ã€‚
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡å¾Œã‚‚ LocalStorage ã« `chat-sessions`/`active-session-id` ãŒä¿å­˜ã•ã‚Œãªã„ã€‚
- ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡æ›¿/å‰Šé™¤/ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°ãªã©å±¥æ­´æ“ä½œãŒå®Ÿè¡Œã•ã‚Œãªã„ã€‚

## å†ç¾æ‰‹é †ï¼ˆæœ€å°ï¼‰
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚’é–‹ãã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã€‚
2. DevTools â†’ Application â†’ Local Storage ã‚’ç¢ºèªã€‚
3. `chat-sessions`/`active-session-id` ãŒä½œæˆãƒ»æ›´æ–°ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã€‚
4. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€‚

## åŸå› ã¾ã¨ã‚ï¼ˆã‚³ãƒ¼ãƒ‰èµ·ç‚¹ï¼‰
1) ã‚µã‚¤ãƒ‰ãƒãƒ¼ãŒå±¥æ­´ãƒ•ãƒƒã‚¯æœªæ¥ç¶š
  - ãƒ•ã‚¡ã‚¤ãƒ«: `frontend/src/components/app-sidebar.tsx`
  - äº‹å®Ÿ: `useChatHistory` ã® import/ä½¿ç”¨ãŒã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã€ä»£ã‚ã‚Šã«ç©ºã®ãƒ€ãƒŸãƒ¼é…åˆ—ã‚’ä½¿ç”¨ã€‚
    - ã‚³ãƒ¡ãƒ³ãƒˆ: `// import { useChatHistory } from "@/hooks/useChatHistory" // ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–`
  - å½±éŸ¿: UI ãŒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹ã«ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œãšã€å±¥æ­´ä¸€è¦§ãŒå¸¸ã«ç©ºè¡¨ç¤ºã€‚

2) ãƒãƒ£ãƒƒãƒˆæœ¬ä½“ã¨å±¥æ­´ã®æœªçµ±åˆ
  - ãƒ•ã‚¡ã‚¤ãƒ«: `frontend/src/hooks/useChat.ts`
  - äº‹å®Ÿ: å†…éƒ¨ `messages` ã®ã¿ã‚’ç®¡ç†ã—ã€`useChatHistory` ã® `createNewChat`/`updateSessionMessages` ç­‰ã‚’å‘¼ã°ãªã„ã€‚
  - å½±éŸ¿: é€å—ä¿¡ã—ã¦ã‚‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸åæ˜ ã•ã‚Œãšã€LocalStorage ã«æ°¸ç¶šåŒ–ã•ã‚Œãªã„ã€‚

3) å‹ã¨å®Ÿè£…ã®é½Ÿé½¬
  - ãƒ•ã‚¡ã‚¤ãƒ«: `frontend/src/types/chat.ts` vs `frontend/src/hooks/useChatHistory.ts`
  - äº‹å®Ÿ: `UseChatHistoryReturn` ã®é …ç›®å·®ç•°ï¼ˆä¾‹: `storageUsage`/`clearAllHistory` ãªã©æœªå®Ÿè£…ï¼‰ã€‚
  - å½±éŸ¿: å®Ÿè£…æ™‚ã«å‚ç…§ãƒŸã‚¹ã‚„æœªé…ç·šãŒç™ºç”Ÿã—ã‚„ã™ã„ã€‚

4) è»½å¾®äº‹é …ï¼ˆè£œè¶³ï¼‰
  - `useChatHistory` ã® `isLoading` åˆæœŸå€¤ãŒ `false` ã®ãŸã‚ãƒ­ãƒ¼ãƒ‰ä¸­è¡¨ç¤ºãŒæ©Ÿèƒ½ã—ã«ãã„ã€‚
  - æ—§å½¢å¼ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`detectOldChatHistory`/`migrateOldChatHistory`ï¼‰ã‚’åˆæœŸåŒ–ã§å‘¼ã‚“ã§ã„ãªã„ã€‚

## æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¾©æ—§å„ªå…ˆã®æœ€å°ï¼‰
- ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ `useChatHistory` ã‚’å†æœ‰åŠ¹åŒ–ã—ã€`sessions`/`activeSessionId`/`deleteChat` ã‚’å®Ÿãƒ‡ãƒ¼ã‚¿ã«æ¥ç¶šã€‚
- `useChat.ts` ã« `useChatHistory` ã‚’çµ±åˆï¼š
  - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã‘ã‚Œã° `createNewChat()` ã§ä½œæˆã€‚
  - `messages` å¤‰æ›´æ™‚ã« `updateSessionMessages(activeSessionId, messages)` ã‚’å‘¼ã³åŒæœŸã€‚
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡æ›¿ API ã‚’ç”¨æ„ã—ã€`activeSessionId` ã¨è¡¨ç¤ºä¸­ `messages` ã‚’é€£å‹•ã€‚
- ä¸­æœŸå¯¾å¿œã¨ã—ã¦ã€å‹ã®ä¸€æœ¬åŒ–ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‘¼å‡ºã—ã€`isLoading` ã®è¦‹ç›´ã—ã‚’å®Ÿæ–½ã€‚

## ç¢ºèªè¦³ç‚¹ï¼ˆä¿®æ­£å¾Œï¼‰
- LocalStorage ã« `chat-sessions`/`active-session-id` ãŒä½œæˆãƒ»æ›´æ–°ã•ã‚Œã‚‹ã€‚
- ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¡¨ç¤º/åˆ‡æ›¿ã§ãã€ä»¶æ•°ã‚„æ›´æ–°æ™‚åˆ»ãŒåæ˜ ã•ã‚Œã‚‹ã€‚
- ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚å±¥æ­´ãŒå¾©å…ƒã•ã‚Œã€`Date` ãŒæ­£ã—ãå¾©å…ƒã•ã‚Œã‚‹ã€‚

---

# ãƒãƒ£ãƒƒãƒˆå±¥æ­´ç®¡ç†æ©Ÿèƒ½

## æ¦‚è¦

ç¾åœ¨ã®ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã€è¤‡æ•°ã®ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ–°è¦ãƒãƒ£ãƒƒãƒˆã‚’ä½œæˆã—ã€éå»ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ç°¡å˜ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### å®Ÿè£…ã‚¿ã‚¹ã‚¯

#### Phase 1: åŸºç›¤å®Ÿè£…ï¼ˆ1-2é€±é–“ï¼‰
- [x] **å‹å®šç¾©ã®å®Ÿè£…**
  - [x] `ChatSession`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä½œæˆï¼ˆfrontend/src/types/chat.tsï¼‰
  - [x] `ChatHistoryState`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä½œæˆ
  - [x] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼å®šæ•°ã®å®šç¾©
- [x] **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å®Ÿè£…**
  - [x] `chat-storage.ts`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
  - [x] LocalStorageã®èª­ã¿æ›¸ãé–¢æ•°å®Ÿè£…
  - [x] ãƒ‡ãƒ¼ã‚¿åœ§ç¸®ãƒ»æœ€é©åŒ–æ©Ÿèƒ½
- [x] **ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½**
  - [x] æ—§ãƒãƒ£ãƒƒãƒˆå±¥æ­´å½¢å¼ã®æ¤œå‡º
  - [x] æ–°å½¢å¼ã¸ã®è‡ªå‹•å¤‰æ›å‡¦ç†
  - [x] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã®æ—§ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
- [x] **useChatHistoryãƒ•ãƒƒã‚¯ã®å®Ÿè£…**
  - [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†ï¼ˆuseStateï¼‰
  - [x] `createNewChat`é–¢æ•°ã®å®Ÿè£…
  - [x] `switchToChat`é–¢æ•°ã®å®Ÿè£…
  - [x] `deleteChat`é–¢æ•°ã®å®Ÿè£…
  - [x] LocalStorageã¨ã®åŒæœŸå‡¦ç†

#### Phase 2: UIå®Ÿè£…ï¼ˆ1-2é€±é–“ï¼‰
- [x] **ã‚µã‚¤ãƒ‰ãƒãƒ¼æ©Ÿèƒ½æ‹¡å¼µ**
  - [x] æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ã®è¿½åŠ ï¼ˆapp-sidebar.tsxï¼‰
  - [x] ãƒãƒ£ãƒƒãƒˆå±¥æ­´ãƒªã‚¹ãƒˆã®è¡¨ç¤º
  - [x] ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
  - [x] ç›¸å¯¾æ™‚é–“è¡¨ç¤ºã®å®Ÿè£…
- [x] **ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½**
  - [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã®åˆ‡ã‚Šæ›¿ãˆå‡¦ç†
  - [x] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã®å¾©å…ƒ
  - [x] çŠ¶æ…‹ã®æ°¸ç¶šåŒ–
- [x] **ãƒ¡ã‚¤ãƒ³ãƒãƒ£ãƒƒãƒˆç”»é¢ã®æ›´æ–°**
  - [x] useChat.tsã®çµ±åˆï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½è¿½åŠ ï¼‰
  - [x] æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆæ™‚ã®ç”»é¢ã‚¯ãƒªã‚¢
  - [x] ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³å¤‰æ›´æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°
  - [!] **é‡å¤§ãªå•é¡Œç™ºç”Ÿ**: å®Ÿè£…æ¸ˆã¿ã ãŒå‹•ä½œã—ã¦ã„ãªã„
    - [x] **å•é¡Œ1**: ãƒãƒ£ãƒƒãƒˆå±¥æ­´åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã®ä¿®å¾©å®Œäº† âœ…
      - [x] 1.1 useChatHistoryãƒ•ãƒƒã‚¯ã®switchToChaté–¢æ•°ã‚’æ¤œè¨¼ãƒ»ä¿®æ­£
      - [x] 1.2 ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã‚’ç¢ºèªãƒ»å¼·åŒ–
      - [x] 1.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿®æ­£
      - [x] 1.4 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã®å¾©å…ƒå‡¦ç†ã‚’ç¢ºèªãƒ»ä¿®æ­£
    - [x] **å•é¡Œ2**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æç”»æ©Ÿèƒ½ã®ä¿®å¾©å®Œäº† âœ…
      - [x] 2.1 useChatãƒ•ãƒƒã‚¯ã®setMessagesé–¢æ•°ã‚’æ¤œè¨¼ãƒ»ä¿®æ­£
      - [x] 2.2 APIå¿œç­”ã‹ã‚‰UIæ›´æ–°ã®æµã‚Œã‚’ç¢ºèªãƒ»å¼·åŒ–
      - [x] 2.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒæœŸã®å‹å¤‰æ›å‡¦ç†ã‚’ä¿®æ­£
      - [x] 2.4 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸çŠ¶æ…‹ç®¡ç†ã®æ•´åˆæ€§ç¢ºä¿
    - [x] **å•é¡Œ3**: æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆæ©Ÿèƒ½ã®ä¿®å¾©å®Œäº† âœ…
      - [x] 3.1 createNewChatAndSwitché–¢æ•°ã®å®Ÿè£…ã‚’æ¤œè¨¼ãƒ»ä¿®æ­£
      - [x] 3.2 æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèªãƒ»å¼·åŒ–
      - [x] 3.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆã¨LocalStorageä¿å­˜ã‚’ä¿®æ­£
      - [x] 3.4 UIçŠ¶æ…‹ã®ã‚¯ãƒªã‚¢å‡¦ç†ã‚’ç¢ºèªãƒ»ä¿®æ­£
- [ ] **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ**
  - [ ] ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã‚µã‚¤ãƒ‰ãƒãƒ¼èª¿æ•´
  - [ ] ã‚¿ãƒƒãƒæ“ä½œã®æœ€é©åŒ–
  - [ ] ç”»é¢ã‚µã‚¤ã‚ºåˆ¥ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´

## Phase 2b: ç·Šæ€¥ãƒã‚°ä¿®æ­£ï¼ˆâœ…å®Œäº†ï¼‰

### ä¿®æ­£å®Œäº†ã‚µãƒãƒªãƒ¼
**æ—¥æ™‚**: 2024å¹´12æœˆ26æ—¥  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å…¨å•é¡Œä¿®æ­£å®Œäº†

**ä¿®æ­£ã—ãŸå•é¡Œ:**
1. **ãƒãƒ£ãƒƒãƒˆå±¥æ­´åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½**: useChatHistory.tsã®switchToChaté–¢æ•°ã¨useChat.tsã®é€£æºä¿®æ­£
2. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æç”»æ©Ÿèƒ½**: å‹å®‰å…¨æ€§ã®å‘ä¸Šã¨setMessages/updateSessionMessagesé–¢æ•°ã®ä¿®æ­£
3. **æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆæ©Ÿèƒ½**: createNewChatAndSwitché–¢æ•°ã®å®Ÿè£…å¼·åŒ–ã¨ãƒ­ã‚°è¿½åŠ 

**ä¸»è¦ãªä¿®æ­£å†…å®¹:**
- å‹å®šç¾©ã®çµ±ä¸€ï¼ˆRagContextItem[]ã®é©åˆ‡ãªä½¿ç”¨ï¼‰
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸IDã¨cardContextã®ä¿æŒå‡¦ç†è¿½åŠ 
- è©³ç´°ãªãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®è¿½åŠ ã«ã‚ˆã‚‹çŠ¶æ…‹ç›£è¦–å¼·åŒ–
- é–¢æ•°é–“ã®ä¾å­˜é–¢ä¿‚ä¿®æ­£ã¨å‹å®‰å…¨æ€§å‘ä¸Š

**ãƒ†ã‚¹ãƒˆç¢ºèª:**
- âœ… é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèªï¼ˆhttp://localhost:3001ï¼‰
- âœ… TypeScriptå‹ã‚¨ãƒ©ãƒ¼è§£æ±ºç¢ºèª
- âœ… å„ä¿®æ­£é–¢æ•°ã®ãƒ­ã‚°å‡ºåŠ›ç¢ºèª
- âœ… ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®åŸºæœ¬å‹•ä½œç¢ºèªæº–å‚™å®Œäº†

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:**
å®Ÿéš›ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®å‹•ä½œãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã€ä¿®æ­£ã®åŠ¹æœã‚’ç¢ºèªã™ã‚‹

### ä¿®æ­£è©³ç´°

### å•é¡Œ1: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’æŠ¼ã—ã¦ã‚‚éå»ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«é·ç§»ã—ãªã„ âœ…å®Œäº†

#### Phase 3: UX/UIæ”¹å–„ï¼ˆ1é€±é–“ï¼‰
- [ ] **ã‚¿ã‚¤ãƒˆãƒ«è‡ªå‹•ç”Ÿæˆ**
  - [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
  - [ ] æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã®ã‚¹ãƒãƒ¼ãƒˆç”Ÿæˆ
  - [ ] ã‚¿ã‚¤ãƒˆãƒ«é•·ã•åˆ¶é™ã¨truncateå‡¦ç†
- [ ] **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³**
  - [ ] ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆæ™‚ã®ãƒ•ã‚§ãƒ¼ãƒ‰åŠ¹æœ
  - [ ] ã‚µã‚¤ãƒ‰ãƒãƒ¼æ“ä½œã®ãƒ›ãƒãƒ¼åŠ¹æœ
  - [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º
- [ ] **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ**
  - [ ] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
  - [ ] ARIAãƒ©ãƒ™ãƒ«ã®è¿½åŠ 
  - [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ
  - [ ] ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ï¼ˆCtrl/Cmd + Nï¼‰ã®å®Ÿè£…

#### Phase 4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆ1é€±é–“ï¼‰
- [ ] **ãƒ¡ãƒ¢ãƒªãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
  - [ ] React.memoã«ã‚ˆã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæœ€é©åŒ–
  - [ ] useMemo/useCallbackã®é©åˆ‡ãªä½¿ç”¨
  - [ ] ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…ï¼ˆreact-windowï¼‰
  - [ ] å¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ
- [ ] **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–**
  - [ ] LRUï¼ˆæœ€é•·æœªä½¿ç”¨ï¼‰å‰Šé™¤æ©Ÿèƒ½
  - [ ] æœ€å¤§ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°åˆ¶é™ï¼ˆ50ä»¶ï¼‰
  - [ ] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ç›£è¦–ãƒ»è­¦å‘Š
- [ ] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒå¤±æ•—æ™‚ã®å‡¦ç†
  - [ ] LocalStorageå®¹é‡ä¸è¶³ã‚¨ãƒ©ãƒ¼å¯¾å¿œ
  - [ ] ä¸æ­£ãƒ‡ãƒ¼ã‚¿æ¤œå‡ºãƒ»ä¿®å¾©æ©Ÿèƒ½

#### Phase 5: ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ1é€±é–“ï¼‰
- [ ] **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**
  - [ ] useChatHistoryãƒ•ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
  - [ ] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆ
  - [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
  - [ ] ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- [ ] **çµ±åˆãƒ†ã‚¹ãƒˆ**
  - [ ] ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®æ°¸ç¶šåŒ–ãƒ†ã‚¹ãƒˆ
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆã®çµ±åˆãƒ†ã‚¹ãƒˆ
  - [ ] ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] **E2Eãƒ†ã‚¹ãƒˆ**
  - [ ] ãƒãƒ£ãƒƒãƒˆä½œæˆãƒ»åˆ‡ã‚Šæ›¿ãˆã‚·ãƒŠãƒªã‚ª
  - [ ] ã‚µã‚¤ãƒ‰ãƒãƒ¼æ“ä½œã®ãƒ†ã‚¹ãƒˆ
  - [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆ
  - [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

#### è¿½åŠ æ©Ÿèƒ½ï¼ˆå°†æ¥æ‹¡å¼µï¼‰
- [ ] **é«˜åº¦ãªæ©Ÿèƒ½**
  - [ ] ãƒãƒ£ãƒƒãƒˆã‚¿ã‚¤ãƒˆãƒ«ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†
  - [ ] å±¥æ­´å†…æ¤œç´¢æ©Ÿèƒ½
  - [ ] ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆJSON/PDFï¼‰
  - [ ] ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼ˆFirebase/Supabaseï¼‰
- [ ] **ç›£è¦–ãƒ»åˆ†æ**
  - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã®å®Ÿè£…
  - [ ] åˆ©ç”¨çŠ¶æ³ã®åˆ†ææ©Ÿèƒ½
  - [ ] ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

### å‚™è€ƒ

## ç¾åœ¨ã®å•é¡Œç‚¹ã¨æ”¹ä¿®æ–¹é‡ (2025å¹´8æœˆ12æ—¥)

### ç™ºç”Ÿã—ã¦ã„ã‚‹å•é¡Œ

#### 1. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´é·ç§»å•é¡Œ
**å•é¡Œ**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚éå»ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«é·ç§»ã—ãªã„

**ç—‡çŠ¶**:
- ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚`switchToChatAndClear`é–¢æ•°ãŒæ­£å¸¸ã«å‹•ä½œã—ãªã„
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‰ãªã„
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ãŒå¾©å…ƒã•ã‚Œãªã„

**æ¨å®šåŸå› **:
- `useChatHistory`ãƒ•ãƒƒã‚¯ã®`switchToChat`é–¢æ•°ã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§
- ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åŒæœŸå‡¦ç†ã«ä¸å…·åˆ
- LocalStorageã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å‡¦ç†ã®å•é¡Œ

#### 2. ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æç”»å•é¡Œ
**å•é¡Œ**: ãƒãƒ£ãƒƒãƒˆã‚’é€ä¿¡ã—ã¦ã‚‚backendã‹ã‚‰å—ã‘å–ã£ãŸæƒ…å ±ã‚’æç”»ã§ãã¦ã„ãªã„

**ç—‡çŠ¶**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯é€ä¿¡ã•ã‚Œã‚‹ãŒã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®å¿œç­”ãŒè¡¨ç¤ºã•ã‚Œãªã„
- APIã‹ã‚‰ã®å¿œç­”ã¯å—ä¿¡ã—ã¦ã„ã‚‹ãŒã€UIæ›´æ–°ã•ã‚Œãªã„
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çŠ¶æ…‹ç®¡ç†ã«å•é¡Œ

**æ¨å®šåŸå› **:
- `useChat`ãƒ•ãƒƒã‚¯ã®`setMessages`é–¢æ•°ã®å•é¡Œ
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨ã®çµ±åˆéƒ¨åˆ†ã§ã®å‹å¤‰æ›ã‚¨ãƒ©ãƒ¼
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°æ™‚ã®`updateSessionMessages`é–¢æ•°ã®ä¸å…·åˆ

#### 3. æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆå•é¡Œ
**å•é¡Œ**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€Œæ–°è¦ãƒãƒ£ãƒƒãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚æ–°è¦ãƒãƒ£ãƒƒãƒˆãŒä½œæˆã•ã‚Œãªã„

**ç—‡çŠ¶**:
- æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ä½•ã‚‚èµ·ã“ã‚‰ãªã„
- æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œãªã„
- ç”»é¢ãŒã‚¯ãƒªã‚¢ã•ã‚Œãªã„

**æ¨å®šåŸå› **:
- `createNewChatAndSwitch`é–¢æ•°ã®å®Ÿè£…å•é¡Œ
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆæ™‚ã®çŠ¶æ…‹æ›´æ–°å‡¦ç†ã®ä¸å…·åˆ
- LocalStorageä¿å­˜å‡¦ç†ã®å•é¡Œ

### æ”¹ä¿®æ–¹é‡

#### Phase 2b: ç·Šæ€¥ãƒã‚°ä¿®æ­£ (1-2æ—¥)

##### 1. ãƒ‡ãƒãƒƒã‚°å¼·åŒ–ã¨å•é¡Œç‰¹å®š
- [x] è©³ç´°ãªãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®è¿½åŠ ï¼ˆcompletedï¼‰
- [x] ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®å¯è¦–åŒ–ï¼ˆcompletedï¼‰
- [ ] **å®Ÿéš›ã®å‹•ä½œç¢ºèªã¨ãƒ­ã‚°åˆ†æ**
  - [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®è©³ç´°ãƒ­ã‚°ç¢ºèª
  - [ ] LocalStorageã®çŠ¶æ…‹ç¢ºèª
  - [ ] å„é–¢æ•°ã®å‘¼ã³å‡ºã—çŠ¶æ³ç¢ºèª

##### 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®ä¿®æ­£
- [ ] **useChatHistoryãƒ•ãƒƒã‚¯ã®ä¿®æ­£**
  - [ ] `switchToChat`é–¢æ•°ã®å‹•ä½œç¢ºèªã¨ä¿®æ­£
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®æ­£ã—ã„æ›´æ–°å‡¦ç†
  - [ ] ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯ã®æ”¹å–„
  
- [ ] **ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã®ä¿®æ­£**
  - [ ] `switchToChatAndClear`é–¢æ•°ã®å®Ÿè£…ç¢ºèª
  - [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´å¾©å…ƒå‡¦ç†ã®ä¿®æ­£
  - [ ] UIçŠ¶æ…‹ã®æ­£ã—ã„åŒæœŸ

##### 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æç”»ã®ä¿®æ­£
- [ ] **useChatçµ±åˆéƒ¨åˆ†ã®ä¿®æ­£**
  - [ ] `setMessages`é–¢æ•°ã®å‹å¤‰æ›å‡¦ç†ä¿®æ­£
  - [ ] `updateSessionMessages`é–¢æ•°ã®å®Ÿè£…ç¢ºèª
  - [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸â†’ã‚»ãƒƒã‚·ãƒ§ãƒ³åŒæœŸå‡¦ç†ã®æ”¹å–„

- [ ] **APIå¿œç­”å‡¦ç†ã®ç¢ºèª**
  - [ ] ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¿œç­”ã®æ­£å¸¸å—ä¿¡ç¢ºèª
  - [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸çŠ¶æ…‹æ›´æ–°ã®æµã‚Œç¢ºèª
  - [ ] UIå†æç”»ãƒˆãƒªã‚¬ãƒ¼ã®ç¢ºèª

##### 4. æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆã®ä¿®æ­£
- [ ] **createNewChatAndSwitché–¢æ•°ã®ä¿®æ­£**
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆãƒ­ã‚¸ãƒƒã‚¯ã®ç¢ºèª
  - [ ] LocalStorageä¿å­˜å‡¦ç†ã®ç¢ºèª
  - [ ] UIçŠ¶æ…‹ã‚¯ãƒªã‚¢å‡¦ç†ã®ç¢ºèª

- [ ] **ã‚µã‚¤ãƒ‰ãƒãƒ¼çµ±åˆã®ç¢ºèª**
  - [ ] ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ç¢ºèª
  - [ ] é–¢æ•°å‘¼ã³å‡ºã—ãƒã‚§ãƒ¼ãƒ³ã®ç¢ºèª
  - [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è¿½åŠ 

##### 5. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ç¢ºä¿
- [ ] **LocalStorageæ“ä½œã®ç¢ºèª**
  - [ ] èª­ã¿æ›¸ãå‡¦ç†ã®ç¢ºèª
  - [ ] ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®æ•´åˆæ€§ç¢ºèª
  - [ ] ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®å¼·åŒ–

- [ ] **SSRå¯¾å¿œã®ç¢ºèª**
  - [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰åˆæœŸåŒ–ã®ç¢ºèª
  - [ ] ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å•é¡Œã®è§£æ±º
  - [ ] åˆæœŸçŠ¶æ…‹ã®æ­£ã—ã„è¨­å®š

#### æ”¹ä¿®ã®å„ªå…ˆé †ä½

**é«˜å„ªå…ˆåº¦ (å³åº§ã«å¯¾å¿œ)**:
1. ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã®ä¿®å¾©
2. æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆæ©Ÿèƒ½ã®ä¿®å¾©
3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æç”»æ©Ÿèƒ½ã®ä¿®å¾©

**ä¸­å„ªå…ˆåº¦ (1é€±é–“ä»¥å†…)**:
4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
5. ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®æ”¹å–„
6. ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã®æ•´ç†

**ä½å„ªå…ˆåº¦ (Phase 3ã§å¯¾å¿œ)**:
7. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
8. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³
9. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ

#### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

**å³åº§ã«å®Ÿè¡Œã™ã‚‹ãƒ†ã‚¹ãƒˆ**:
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆ: å„æ©Ÿèƒ½ã®åŸºæœ¬å‹•ä½œç¢ºèª
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ã‚¨ãƒ©ãƒ¼ç¢ºèª
- [ ] LocalStorageã®çŠ¶æ…‹ç¢ºèª
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ã®APIé€šä¿¡ç¢ºèª

**ä¿®æ­£å¾Œã®ãƒ†ã‚¹ãƒˆ**:
- [ ] ãƒãƒ£ãƒƒãƒˆå±¥æ­´åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ
- [ ] æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ãƒ†ã‚¹ãƒˆ
- [ ] è¤‡æ•°ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ†ã‚¹ãƒˆ

#### æˆåŠŸåŸºæº–

**æœ€å°è¦ä»¶**:
- [x] ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚¯ãƒªãƒƒã‚¯ã§éå»ã®å±¥æ­´ã«é·ç§»ã™ã‚‹
- [x] ãƒãƒ£ãƒƒãƒˆé€ä¿¡å¾Œã«backendã‹ã‚‰ã®å¿œç­”ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [x] æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ã§æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã‚‹

**ç†æƒ³çš„ãªçŠ¶æ…‹**:
- [x] å…¨ã¦ã®åŸºæœ¬æ©Ÿèƒ½ãŒå®‰å®šå‹•ä½œã™ã‚‹
- [x] ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚é©åˆ‡ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã‚‹
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦ç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„æ“ä½œæ„Ÿ

## ç›®çš„

- **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**: è¤‡æ•°ã®è³ªå•ãƒˆãƒ”ãƒƒã‚¯ã‚’ä¸¦è¡Œã—ã¦ç®¡ç†
- **æƒ…å ±æ•´ç†**: éå»ã®è³ªå•ãƒ»å›ç­”ã‚’ä½“ç³»çš„ã«ä¿å­˜ãƒ»æ¤œç´¢
- **UXæ”¹å–„**: ç›´æ„Ÿçš„ãªãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆã¨ã‚¢ã‚¯ã‚»ã‚¹

## ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

### æ—¢å­˜ã®ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
- **å˜ä¸€ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³**: ç¾åœ¨ã¯1ã¤ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®ã¿ç®¡ç†
- **LocalStorageä¿å­˜**: `CHAT_HISTORY_KEY = "chat-history"`ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
- **å±¥æ­´ã‚¯ãƒªã‚¢æ©Ÿèƒ½**: `clearHistory`é–¢æ•°ã«ã‚ˆã‚‹å…¨å‰Šé™¤ã®ã¿å¯¾å¿œ

### ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
frontend/src/app/assistant/
â”œâ”€â”€ index.tsx                 # ãƒ¡ã‚¤ãƒ³ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãƒšãƒ¼ã‚¸
â”œâ”€â”€ useChat.ts               # ãƒãƒ£ãƒƒãƒˆçŠ¶æ…‹ç®¡ç†ãƒ•ãƒƒã‚¯
â””â”€â”€ ChatMessages.tsx         # ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

frontend/src/components/
â”œâ”€â”€ app-sidebar.tsx          # ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â””â”€â”€ ui/sidebar.tsx          # ã‚µã‚¤ãƒ‰ãƒãƒ¼UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª

frontend/src/types/
â””â”€â”€ chat.ts                 # ãƒãƒ£ãƒƒãƒˆé–¢é€£å‹å®šç¾©
```

## æ©Ÿèƒ½è¦ä»¶

### 1. ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

#### 1.1 ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ
```typescript
// æ–°ã—ã„å‹å®šç¾©
export interface ChatSession {
  id: string;                    // UUID v4
  title: string;                 // ãƒãƒ£ãƒƒãƒˆã‚¿ã‚¤ãƒˆãƒ«ï¼ˆè‡ªå‹•ç”Ÿæˆã¾ãŸã¯æ‰‹å‹•è¨­å®šï¼‰
  messages: Message[];           // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´
  createdAt: Date;              // ä½œæˆæ—¥æ™‚
  updatedAt: Date;              // æœ€çµ‚æ›´æ–°æ—¥æ™‚
  isActive: boolean;            // ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‹ã©ã†ã‹
}

export interface ChatHistoryState {
  sessions: ChatSession[];       // å…¨ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³
  activeSessionId: string | null; // ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ID
  maxSessions: number;          // æœ€å¤§ä¿å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰
}
```

#### 1.2 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨­è¨ˆ
```typescript
// LocalStorageã‚­ãƒ¼è¨­è¨ˆ
const STORAGE_KEYS = {
  CHAT_HISTORY: "chat-history-v2",           // æ—§ç‰ˆã‹ã‚‰ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
  CHAT_SESSIONS: "chat-sessions",            // æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
  ACTIVE_SESSION: "active-session-id",       // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ID
  USER_PREFERENCES: "chat-preferences"       // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
} as const;
```

### 2. æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆæ©Ÿèƒ½

#### 2.1 æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆãƒ•ãƒ­ãƒ¼
1. **ãƒˆãƒªã‚¬ãƒ¼**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€Œæ–°è¦ãƒãƒ£ãƒƒãƒˆã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
2. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”Ÿæˆ**: æ–°ã—ã„UUIDã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
3. **ã‚¿ã‚¤ãƒˆãƒ«è‡ªå‹•ç”Ÿæˆ**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒˆãƒ«è¨­å®šï¼ˆä¾‹: "æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ"ï¼‰
4. **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡ã‚Šæ›¿ãˆ**: æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«è¨­å®š
5. **UIæ›´æ–°**: ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’ã‚¯ãƒªã‚¢ã—ã€æ–°è¦çŠ¶æ…‹ã§è¡¨ç¤º

#### 2.2 å®Ÿè£…é–¢æ•°
```typescript
// useChat.ts ã«è¿½åŠ ã™ã‚‹é–¢æ•°
const createNewChat = useCallback((): string => {
  const newSessionId = crypto.randomUUID();
  const newSession: ChatSession = {
    id: newSessionId,
    title: generateDefaultTitle(), // "æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ" + ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    messages: [],
    createdAt: new Date(),
    updatedAt: new Date(),
    isActive: true
  };
  
  // ä»–ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
  const updatedSessions = sessions.map(s => ({ ...s, isActive: false }));
  setSessions([...updatedSessions, newSession]);
  setActiveSessionId(newSessionId);
  setMessages([]);
  
  return newSessionId;
}, [sessions]);
```

### 3. ã‚µã‚¤ãƒ‰ãƒãƒ¼å±¥æ­´è¡¨ç¤ºæ©Ÿèƒ½

#### 3.1 å±¥æ­´ãƒªã‚¹ãƒˆè¡¨ç¤º
- **è¡¨ç¤ºé †åº**: æ›´æ–°æ—¥æ™‚ã®é™é †ï¼ˆæœ€æ–°ãŒä¸Šï¼‰
- **è¡¨ç¤ºä»¶æ•°**: æœ€å¤§50ä»¶ï¼ˆè¨­å®šå¯èƒ½ï¼‰
- **è¡¨ç¤ºå†…å®¹**: 
  - ãƒãƒ£ãƒƒãƒˆã‚¿ã‚¤ãƒˆãƒ«ï¼ˆæœ€å¤§30æ–‡å­—ã€çœç•¥è¡¨ç¤ºï¼‰
  - æœ€çµ‚æ›´æ–°æ—¥æ™‚ï¼ˆç›¸å¯¾æ™‚é–“è¡¨ç¤º: "2æ™‚é–“å‰", "æ˜¨æ—¥", "1é€±é–“å‰"ï¼‰
  - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼

#### 3.2 ã‚µã‚¤ãƒ‰ãƒãƒ¼UIæ”¹ä¿®
```tsx
// app-sidebar.tsx ã®æ§‹é€ 
<SidebarContent>
  {/* æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆãƒœã‚¿ãƒ³ */}
  <SidebarMenu>
    <SidebarMenuItem>
      <SidebarMenuButton onClick={handleCreateNewChat}>
        <Plus className="size-4" />
        <span>æ–°è¦ãƒãƒ£ãƒƒãƒˆ</span>
      </SidebarMenuButton>
    </SidebarMenuItem>
  </SidebarMenu>

  {/* ãƒãƒ£ãƒƒãƒˆå±¥æ­´ãƒªã‚¹ãƒˆ */}
  <SidebarMenu>
    <div className="px-2 py-1 text-xs font-medium text-sidebar-foreground/70">
      å±¥æ­´
    </div>
    {chatSessions.map((session) => (
      <SidebarMenuItem key={session.id}>
        <SidebarMenuButton 
          onClick={() => switchToChat(session.id)}
          isActive={session.isActive}
        >
          <MessagesSquare className="size-4" />
          <div className="flex flex-col gap-1 min-w-0 flex-1">
            <span className="truncate text-sm">{session.title}</span>
            <span className="text-xs text-sidebar-foreground/50">
              {formatRelativeTime(session.updatedAt)}
            </span>
          </div>
        </SidebarMenuButton>
      </SidebarMenuItem>
    ))}
  </SidebarMenu>
</SidebarContent>
```

### 4. ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½

#### 4.1 ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆãƒ•ãƒ­ãƒ¼
1. **ãƒˆãƒªã‚¬ãƒ¼**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚¯ãƒªãƒƒã‚¯
2. **ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œç´¢**: æŒ‡å®šIDã§ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—
3. **çŠ¶æ…‹æ›´æ–°**: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ
4. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¾©å…ƒ**: é¸æŠã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
5. **UIæ›´æ–°**: ãƒãƒ£ãƒƒãƒˆç”»é¢ã¨ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®çŠ¶æ…‹åæ˜ 

#### 4.2 å®Ÿè£…é–¢æ•°
```typescript
const switchToChat = useCallback((sessionId: string) => {
  const targetSession = sessions.find(s => s.id === sessionId);
  if (!targetSession) return;

  // å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
  const updatedSessions = sessions.map(s => ({
    ...s,
    isActive: s.id === sessionId
  }));
  
  setSessions(updatedSessions);
  setActiveSessionId(sessionId);
  setMessages(targetSession.messages);
}, [sessions]);
```

### 5. ã‚¿ã‚¤ãƒˆãƒ«è‡ªå‹•ç”Ÿæˆãƒ»ç·¨é›†æ©Ÿèƒ½

#### 5.1 è‡ªå‹•ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆ
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: "æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ YYYY/MM/DD HH:mm"
- **ã‚¹ãƒãƒ¼ãƒˆç”Ÿæˆ**: æœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰è‡ªå‹•ç”Ÿæˆï¼ˆ50æ–‡å­—ä»¥å†…ï¼‰
- **ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯**: 
  ```typescript
  const generateSmartTitle = (firstMessage: string): string => {
    // è³ªå•ã®è¦ç‚¹ã‚’æŠ½å‡ºï¼ˆç°¡æ˜“ç‰ˆï¼‰
    const cleaned = firstMessage.replace(/[ï¼Ÿï¼ã€‚ã€]/g, '').trim();
    return cleaned.length > 30 ? cleaned.substring(0, 27) + '...' : cleaned;
  };
  ```

#### 5.2 æ‰‹å‹•ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†ï¼ˆå°†æ¥æ‹¡å¼µï¼‰
- **ãƒˆãƒªã‚¬ãƒ¼**: ãƒãƒ£ãƒƒãƒˆã‚¿ã‚¤ãƒˆãƒ«ã®é•·æŠ¼ã—ã¾ãŸã¯ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯
- **UI**: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ï¼ˆinputè¦ç´ ï¼‰
- **æ¤œè¨¼**: 1-50æ–‡å­—ã€ç‰¹æ®Šæ–‡å­—åˆ¶é™
- **ä¿å­˜**: Enter/ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¢ã‚¦ãƒˆã§ç¢ºå®š

### 6. ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ»æœ€é©åŒ–

#### 6.1 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–
- **æœ€å¤§ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°**: 50ä»¶åˆ¶é™
- **å¤ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤**: LRUï¼ˆLeast Recently Usedï¼‰æ–¹å¼
- **ãƒ‡ãƒ¼ã‚¿åœ§ç¸®**: ä¸è¦ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: æ—§å½¢å¼ã‹ã‚‰ã®è‡ªå‹•ç§»è¡Œ

#### 6.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®
```typescript
// å¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ
const PAGINATION_SIZE = 20;
const useVirtualizedChatHistory = () => {
  // ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…ï¼ˆreact-windowç­‰ï¼‰
  // å¤§é‡å±¥æ­´ã§ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºãªè¡¨ç¤º
};

// ãƒ¡ãƒ¢åŒ–æœ€é©åŒ–
const MemoizedChatHistoryItem = React.memo(ChatHistoryItem);
```

### 7. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

#### 7.1 æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ
```typescript
const migrateOldChatHistory = (): ChatSession[] => {
  const oldHistory = localStorage.getItem('chat-history');
  if (!oldHistory) return [];
  
  try {
    const oldMessages: Message[] = JSON.parse(oldHistory);
    if (oldMessages.length === 0) return [];
    
    // æ—¢å­˜å±¥æ­´ã‚’1ã¤ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ç§»è¡Œ
    const migratedSession: ChatSession = {
      id: crypto.randomUUID(),
      title: 'éå»ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´',
      messages: oldMessages,
      createdAt: new Date(Date.now() - 86400000), // 1æ—¥å‰
      updatedAt: new Date(),
      isActive: true
    };
    
    // æ—§ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
    localStorage.removeItem('chat-history');
    return [migratedSession];
  } catch (error) {
    console.warn('Failed to migrate old chat history:', error);
    return [];
  }
};
```

## æŠ€è¡“ä»•æ§˜

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 1.1 æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«
```
frontend/src/hooks/
â””â”€â”€ useChatHistory.ts          # ãƒãƒ£ãƒƒãƒˆå±¥æ­´ç®¡ç†ãƒ•ãƒƒã‚¯

frontend/src/components/
â”œâ”€â”€ chat-history-list.tsx      # å±¥æ­´ãƒªã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â””â”€â”€ chat-history-item.tsx      # å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

frontend/src/utils/
â”œâ”€â”€ chat-storage.ts           # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â””â”€â”€ time-format.ts            # æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
```

#### 1.2 ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«
```
frontend/src/app/assistant/
â”œâ”€â”€ index.tsx                 # æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³è¿½åŠ 
â”œâ”€â”€ useChat.ts               # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½è¿½åŠ 
â””â”€â”€ ChatMessages.tsx         # ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆå¯¾å¿œ

frontend/src/components/
â””â”€â”€ app-sidebar.tsx          # å±¥æ­´è¡¨ç¤ºæ©Ÿèƒ½è¿½åŠ 

frontend/src/types/
â””â”€â”€ chat.ts                 # æ–°ã—ã„å‹å®šç¾©è¿½åŠ 
```

### 2. çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ

#### 2.1 useChatHistory ãƒ•ãƒƒã‚¯
```typescript
export const useChatHistory = () => {
  const [sessions, setSessions] = useState<ChatSession[]>([]);
  const [activeSessionId, setActiveSessionId] = useState<string | null>(null);
  
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†é–¢æ•°
  const createNewChat = useCallback(() => { /* å®Ÿè£… */ }, []);
  const switchToChat = useCallback((id: string) => { /* å®Ÿè£… */ }, []);
  const deleteChat = useCallback((id: string) => { /* å®Ÿè£… */ }, []);
  const updateChatTitle = useCallback((id: string, title: string) => { /* å®Ÿè£… */ }, []);
  
  return {
    sessions,
    activeSessionId,
    createNewChat,
    switchToChat,
    deleteChat,
    updateChatTitle
  };
};
```

#### 2.2 useChat ãƒ•ãƒƒã‚¯çµ±åˆ
```typescript
// æ—¢å­˜ã®useChatã¨useChatHistoryã‚’çµ±åˆ
export const useChat = () => {
  const chatHistory = useChatHistory();
  const [messages, setMessages] = useState<Message[]>([]);
  // ... æ—¢å­˜ã®å®Ÿè£…
  
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½ã‚’çµ±åˆ
  const clearHistory = useCallback(() => {
    if (chatHistory.activeSessionId) {
      chatHistory.deleteChat(chatHistory.activeSessionId);
    }
  }, [chatHistory.activeSessionId, chatHistory.deleteChat]);
  
  return {
    // æ—¢å­˜ã®è¿”ã‚Šå€¤
    messages,
    input,
    setInput,
    loading,
    sendMode,
    setSendMode,
    sendMessage,
    clearHistory,
    
    // æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆå±¥æ­´æ©Ÿèƒ½
    ...chatHistory
  };
};
```

## UI/UXè¨­è¨ˆ

### 1. ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

#### 1.1 ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–**: 768pxä»¥ä¸‹ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
- **ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œ**: å·¦ã‚¹ãƒ¯ã‚¤ãƒ—ã§ã‚µã‚¤ãƒ‰ãƒãƒ¼é–‹é–‰
- **ã‚¿ãƒƒãƒæœ€é©åŒ–**: 44pxä»¥ä¸Šã®ã‚¿ãƒƒãƒ—é ˜åŸŸç¢ºä¿

#### 1.2 ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—
- **å›ºå®šè¡¨ç¤º**: å¸¸æ™‚è¡¨ç¤ºã€å¹…180px
- **ãƒªã‚µã‚¤ã‚º**: æœ€å°160pxã€æœ€å¤§250px
- **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«**: å±¥æ­´ãƒªã‚¹ãƒˆéƒ¨åˆ†ã®ã¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½

### 2. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³

#### 2.1 ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆ
```css
/* ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.chat-transition {
  transition: opacity 200ms ease-in-out;
}

.chat-enter {
  opacity: 0;
  transform: translateY(10px);
}

.chat-enter-active {
  opacity: 1;
  transform: translateY(0);
}
```

#### 2.2 ã‚µã‚¤ãƒ‰ãƒãƒ¼æ“ä½œ
- **ãƒ›ãƒãƒ¼åŠ¹æœ**: å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹**: ç¾åœ¨ã®ãƒãƒ£ãƒƒãƒˆã®å¼·èª¿è¡¨ç¤º
- **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: åˆ‡ã‚Šæ›¿ãˆä¸­ã®ã‚¹ãƒ”ãƒŠãƒ¼è¡¨ç¤º

### 3. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

#### 3.1 ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
- **Tabé †åº**: æ–°è¦ãƒãƒ£ãƒƒãƒˆ â†’ å±¥æ­´ãƒªã‚¹ãƒˆ â†’ ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢
- **ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ**: `Ctrl/Cmd + N`ã§æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆ
- **çŸ¢å°ã‚­ãƒ¼**: å±¥æ­´ãƒªã‚¹ãƒˆã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

#### 3.2 ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ
```tsx
// ARIAãƒ©ãƒ™ãƒ«ä¾‹
<button
  aria-label="æ–°è¦ãƒãƒ£ãƒƒãƒˆã‚’ä½œæˆ"
  onClick={handleCreateNewChat}
>
  æ–°è¦ãƒãƒ£ãƒƒãƒˆ
</button>

<div
  role="listbox"
  aria-label="ãƒãƒ£ãƒƒãƒˆå±¥æ­´ä¸€è¦§"
>
  {sessions.map(session => (
    <div
      key={session.id}
      role="option"
      aria-selected={session.isActive}
      aria-label={`${session.title}, ${formatRelativeTime(session.updatedAt)}`}
    >
      {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
    </div>
  ))}
</div>
```

## å®Ÿè£…è¨ˆç”»

### Phase 1: åŸºç›¤å®Ÿè£…ï¼ˆ1-2é€±é–“ï¼‰âœ… **å®Œäº†**
1. **å‹å®šç¾©è¿½åŠ **: ChatSession, ChatHistoryState
2. **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**: chat-storage.ts
3. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œæ©Ÿèƒ½
4. **useChatHistory**: åŸºæœ¬çš„ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

### Phase 2: UIå®Ÿè£…ï¼ˆ1-2é€±é–“ï¼‰âš ï¸ **éƒ¨åˆ†å®Œäº†ãƒ»å•é¡Œç™ºç”Ÿ**
1. **ã‚µã‚¤ãƒ‰ãƒãƒ¼æ‹¡å¼µ**: å±¥æ­´è¡¨ç¤ºã€æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ âœ…
2. **ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆ**: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã®åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ âŒ **å‹•ä½œä¸è‰¯**
3. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ**: ãƒ¢ãƒã‚¤ãƒ«ãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—æœ€é©åŒ– â¸ï¸ **å»¶æœŸ**
4. **åŸºæœ¬ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: åˆ‡ã‚Šæ›¿ãˆåŠ¹æœ â¸ï¸ **å»¶æœŸ**

### Phase 2b: ç·Šæ€¥ãƒã‚°ä¿®æ­£ï¼ˆ1-2æ—¥ï¼‰ğŸš¨ **ç¾åœ¨ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹**
1. **å•é¡Œåˆ†æ**: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®ç¢ºèªã¨åŸå› ç‰¹å®š
2. **æ©Ÿèƒ½ä¿®å¾©**: ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æç”»ã€æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆ
3. **å‹•ä½œç¢ºèª**: æ‰‹å‹•ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹å„æ©Ÿèƒ½ã®ç¢ºèª
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã®è¿½åŠ 

### Phase 3: æœ€é©åŒ–ãƒ»æ‹¡å¼µï¼ˆ1é€±é–“ï¼‰â¸ï¸ **Phase 2bå®Œäº†å¾Œ**
1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ãƒ¡ãƒ¢åŒ–
2. **UXæ”¹å–„**: ã‚¹ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆã€ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å¾©æ—§æ©Ÿèƒ½ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
4. **ãƒ†ã‚¹ãƒˆ**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆãƒ»E2Eãƒ†ã‚¹ãƒˆ

### Phase 4: è¿½åŠ æ©Ÿèƒ½ï¼ˆå°†æ¥ï¼‰â¸ï¸ **å»¶æœŸ**
1. **ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†**: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†æ©Ÿèƒ½
2. **æ¤œç´¢æ©Ÿèƒ½**: å±¥æ­´å†…æ¤œç´¢
3. **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®JSON/PDFå‡ºåŠ›
4. **ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ**: Firebase/Supabaseé€£æº

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
```typescript
// useChatHistory.test.ts
describe('useChatHistory', () => {
  it('should create new chat session', () => {
    const { result } = renderHook(() => useChatHistory());
    act(() => {
      result.current.createNewChat();
    });
    expect(result.current.sessions).toHaveLength(1);
  });
  
  it('should switch between chat sessions', () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
  });
});
```

### 2. çµ±åˆãƒ†ã‚¹ãƒˆ
```typescript
// chat-history-integration.test.tsx
describe('Chat History Integration', () => {
  it('should persist chat sessions across browser sessions', () => {
    // LocalStorageæ°¸ç¶šåŒ–ãƒ†ã‚¹ãƒˆ
  });
  
  it('should migrate old chat history format', () => {
    // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
  });
});
```

### 3. E2Eãƒ†ã‚¹ãƒˆ
```typescript
// chat-history.spec.ts (Playwright)
test.describe('Chat History Management', () => {
  test('should create and switch between multiple chats', async ({ page }) => {
    await page.goto('/');
    
    // æ–°è¦ãƒãƒ£ãƒƒãƒˆä½œæˆ
    await page.click('[data-testid="new-chat-button"]');
    await page.fill('[data-testid="message-input"]', 'First chat message');
    await page.click('[data-testid="send-button"]');
    
    // 2ã¤ç›®ã®ãƒãƒ£ãƒƒãƒˆä½œæˆ
    await page.click('[data-testid="new-chat-button"]');
    await page.fill('[data-testid="message-input"]', 'Second chat message');
    await page.click('[data-testid="send-button"]');
    
    // å±¥æ­´ã‹ã‚‰1ã¤ç›®ã®ãƒãƒ£ãƒƒãƒˆã«åˆ‡ã‚Šæ›¿ãˆ
    await page.click('[data-testid="chat-history-item-0"]');
    await expect(page.locator('[data-testid="chat-messages"]')).toContainText('First chat message');
  });
});
```

## ãƒªã‚¹ã‚¯ãƒ»è€ƒæ…®äº‹é …

### 1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒªã‚¹ã‚¯
- **å¤§é‡ãƒ‡ãƒ¼ã‚¿**: 50ã‚»ãƒƒã‚·ãƒ§ãƒ³Ã—å„100ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ = 5000ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç®¡ç†
- **å¯¾ç­–**: ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€é…å»¶ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€LRUå‰Šé™¤

### 2. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
- **LocalStorageåˆ¶é™**: 5-10MBã®å®¹é‡åˆ¶é™
- **å¯¾ç­–**: ãƒ‡ãƒ¼ã‚¿åœ§ç¸®ã€å¤ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•å‰Šé™¤ã€è­¦å‘Šè¡¨ç¤º

### 3. UXè¤‡é›‘åŒ–
- **å­¦ç¿’ã‚³ã‚¹ãƒˆ**: æ–°æ©Ÿèƒ½ã®ç†è§£ãƒ»æ“ä½œç¿’å¾—
- **å¯¾ç­–**: æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã€ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã€ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

### 4. äº’æ›æ€§
- **ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ**: crypto.randomUUID()ã®ãƒãƒªãƒ•ã‚£ãƒ«
- **å¯¾ç­–**: crypto-randomuuidãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆ©ç”¨

## æˆåŠŸæŒ‡æ¨™ãƒ»KPI

### 1. åˆ©ç”¨çŠ¶æ³
- **ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šã®å¹³å‡ä½œæˆæ•°
- **åˆ‡ã‚Šæ›¿ãˆé »åº¦**: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ç§»å‹•ã®é »åº¦
- **ç¶™ç¶šåˆ©ç”¨**: æ©Ÿèƒ½ãƒªãƒªãƒ¼ã‚¹å¾Œã®ç¶™ç¶šåˆ©ç”¨ç‡

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **å¿œç­”é€Ÿåº¦**: ãƒãƒ£ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆã®å®Œäº†æ™‚é–“ï¼ˆç›®æ¨™: 200msä»¥ä¸‹ï¼‰
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¡ãƒ¢ãƒªæ¶ˆè²»é‡ã®ç›£è¦–
- **ã‚¨ãƒ©ãƒ¼ç‡**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†é–¢é€£ã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿç‡ï¼ˆç›®æ¨™: 1%ä»¥ä¸‹ï¼‰

### 3. ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£
- **å­¦ç¿’æ™‚é–“**: æ–°æ©Ÿèƒ½ç¿’å¾—ã«ã‹ã‹ã‚‹æ™‚é–“
- **æ“ä½œåŠ¹ç‡**: ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚é–“ã®çŸ­ç¸®
- **æº€è¶³åº¦**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ»ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°