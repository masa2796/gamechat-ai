# 挨拶検出・早期応答システム（ARCHIVE_CANDIDATE）

最終更新: 2025-09-21（MVP除外）

## 概要
- 目的: 挨拶クエリを検出し、ベクトル検索をスキップして即時の定型応答を返すことで応答時間を短縮する。
- 期待効果: 平均応答時間を大幅短縮（過去測定: 最大87%短縮）。
- 現状: MVPでは機能を使用しないため、関連コード・スクリプトはアーカイブ候補として扱う。

## 除外理由（MVP方針）
- MVPは「ベクトル検索のみ・/chat一律」でシンプルに提供する。
- 実装・検証コストに対する価値を初期段階では優先しない。
- 失敗時のフォールバック設計が複雑化するため初期は排除。

## 対象/関連ファイル
- `scripts/testing/test_greeting_detection.py`（テストスクリプト、現在リポジトリ内に存在しない可能性あり）
- `scripts/testing/README.md`（当該スクリプトの説明。MVP外注記を追加済み）
- ドキュメント各所の記載（readme/guides/sphinx など）

## 影響
- 現在の `/chat`（MVP）は一律ベクトル検索のため、未実装でも機能影響なし。
- 本機能のアーカイブ/未使用は Cloud Run/Firebase デプロイに影響しない。

## 復活（再導入）手順ガイド（案）
1. 判定ロジックを追加
   - クライアント入力を対象に簡易ルール or 軽量モデルで `greeting` を判定
   - しきい値・ルールは `.env` で切替可能にする
2. 早期応答の組み込み
   - `/chat` ルーター内で greeting の場合は検索をスキップし、定型応答を返す
   - 応答テンプレートは `services/llm_service.py` などで一元管理
3. テストを整備
   - `scripts/testing/test_greeting_detection.py` を復活/作成し精度・応答時間を計測
   - バックエンドのユニットテストに greeting 分岐のSmokeを追加
4. ドキュメント更新
   - 本ファイルのステータス変更、`docs/project/release_mvp.md` の除外一覧から削除

## 注意点
- 誤検出時のUX悪化を防ぐため、低信頼スコア時は通常検索へフォールバック。
- 多言語やスラング対応のルール整備が必要になる場合あり。

---
参考: `docs/project/release_mvp.md` の「除外範囲」「アーカイブ移行候補」節を参照。
