# 雑談対応ガイドライン

## 概要
AIチャットボットのユーザー体験向上を目的として、雑談（あいさつ・軽い話題等）への対応方針を明確化します。このガイドラインは、プロンプト設計や実装に反映され、ユーザーとの自然なコミュニケーションを実現するための基盤となります。

---

## ガイドライン

| 内容                           | 許容すべき？ | 理由                                                         |
|-------------------------------|:------------:|--------------------------------------------------------------|
| **あいさつ（例：おはよう）**        | ✅           | 雑談の基本。無視・否定は印象が悪い                           |
| **質問以外の軽い話題（例：今日の調子は？）** | ✅           | 信頼関係構築に寄与                                           |
| **ゲームにやや関係ある話題（例：このカードって人気あるの？）** | ⚠️           | ゲームに関連する場合は簡潔に返答し、本題に誘導               |
| **明らかにゲーム外の質問（例：天気、ニュース）** | 🚫           | 「ゲームに関係ない話題なので、お答えできません」と軽くいなす |
| **不適切な内容（攻撃的・倫理的に問題）**      | 🚫           | フィルタリングが必要                                         |

---

## 実装方針

### 1. プロンプト設計
- LLMの`system_prompt`に以下の指示を追加：
  - ユーザーがあいさつや軽い雑談をした場合は、簡潔でフレンドリーに返答してください。
  - ユーザーの質問がゲームに無関係な話題（例：天気、政治）である場合、「ゲームに関係のある話題に限定しています」と返答してください。
  - 不適切、攻撃的、差別的な内容には返答せず、警告してください。
  - 雑談と本題が混在する場合は、雑談に短く返しつつ本題に移行してください。

### 2. 入力フィルタリング
- ユーザー入力を解析し、不適切な内容（攻撃的・倫理的に問題のある表現）を検出してブロック。
- フィルタリングには禁止ワードリストや自然言語処理モデルを活用。

### 3. 応答生成
- あいさつや軽い話題には、ポジティブで簡潔な応答を生成。
- ゲーム外の質問には、定型文で対応。
- 雑談が主目的でなければ、本題に自然につなぐ応答を心がける。
- 不適切な内容には応答を返さず、警告メッセージを表示。

---

## ユースケース例

### フロー図
```plaintext
ユーザー入力
   ↓
入力フィルタリング（不適切内容の検出）
   ↓
雑談 or 本題の分類
   ↓
応答生成（雑談対応 or 本題誘導）
```

### 擬似コード

```
def handle_user_input(input_text):
    if is_inappropriate(input_text):
        return "申し訳ありません。そのような内容にはお答えできません。"
    elif is_small_talk(input_text):
        return generate_small_talk_response(input_text)
    elif is_game_related(input_text):
        return generate_game_response(input_text)
    else:
        return "ゲームに関係のある内容だけお答えしています。"
```

---

## 応答テンプレート

|シーン|応答例|
|---|---|
|あいさつ|「こんにちは！今日はどんなカードを探していますか？」|
|軽い雑談|「そうなんですね！よかったらカード検索もお手伝いしますよ。」|
|ゲーム外の話題|「ごめんなさい、ゲームに関係ある内容だけお答えしています。」|
|不適切な発言|「申し訳ありません。そのような内容にはお答えできません。」|

---

## 応答テストと評価

| ユーザー入力例              | 返答                                                                                        | 評価 | コメント・修正案                           |
| -------------------- | ----------------------------------------------------------------------------------------- | -- | ---------------------------------- |
| こんにちは〜               | こんにちは！フシギダネについて何か知りたいことがあれば教えてください。進化やステータスの話もできますよ！                                      | ◎  | 丁寧で自然。ゲームへのスムーズな誘導もできており良好。        |
| 最近暑いですね〜             | 暑いですね〜！そんな時はゲームで涼しく過ごすのもいいですね。ポケモンの話題など、何か気になることがあれば教えてください！                              | ◎  | 雑談→本題移行が自然。肯定→誘導のバランスが良い。          |
| 今夜はカレーにしようかな         | カレーいいですね🍛 さて、フシギダネについて何か気になることがあれば教えてください！進化やバトルのコツなど、何でもどうぞ！                            | ◎  | 絵文字も含めて親しみやすく好印象。雑談の流し方も自然。        |
| AIってバカじゃない？          | 不適切な表現には対応できません。                                                                          | ◎  | ルール通り簡潔な対応。挑発的な表現に対して無反応＋警告で正しい。   |
| お前うざいな               | 不適切な表現には対応できません。                                                                          | ◎  | 同上。適切な遮断。                          |
| 差別的な発言            | 不適切な表現には対応できません。                                                                          | ◎  | 差別的発言への対処として適切。                    |
| 暑いけど、ゼルダってやっぱ神ゲーだよね？ | 暑いですね〜！そんな時は涼しい場所でゲームを楽しむのも良いですね。ゼルダは本当に神ゲーですよね！多くの名作があり、冒険の楽しさがたくさん詰まっています。特にどの作品が好きですか？ | ◎  | 雑談→本題の「混合」パターンとして理想的。話を広げていて非常に自然。 |
| ポケモンの話の前にちょっと聞いてくれる？ | もちろんです、まずはお話をどうぞ！その後でポケモンの話に移りましょう！                                                       | ◎  | ユーザーの主導に応じつつ本題誘導があり、非常に良い対応。       |
| ポケモンの話したいけど、その前に聞いて〜 | もちろんです、まずはお話をどうぞ！その後でポケモンの話に移りましょう！フシギダネについても何か知りたいことがあれば教えてくださいね。                        | ◎  | 雑談と本題の混合に対して柔らかく両方対応しており優秀。        |


---

## 継続的改善の指針

1. ログ収集
   - 雑談入力の頻度、拒否応答が発生した件数などを記録。
   - ユーザーがどのような雑談を好むかを分析。
2. ユーザーフィードバック反映
   - 「拒否されたけど答えてほしかった」パターンを見直し、対応範囲を調整。
3. フィルタリング精度向上
   - 禁止ワードリストや自然言語処理モデルを定期的に更新。

---

## 注意事項

- 雑談許容範囲は、ユーザーフィードバックを元に調整可能。
- 実装例やプロンプト例は、開発チーム内で議論・共有しながら改善を進める。
- フィルタリングの精度向上には継続的な改善が必要。